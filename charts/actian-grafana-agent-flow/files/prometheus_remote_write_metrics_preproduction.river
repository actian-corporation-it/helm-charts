// Prometheus Remote Write URL
argument "url" {
	optional = false
}

// Prometheus User
argument "username" {
	optional = false
}

// Prometheus Password
argument "password" {
	optional = false
}

// Cluster name
argument "cluster_name" {
	optional = false
}

// Cluster environment (cloudopsdev, dev, test, stage, production)
argument "environment" {
	optional = false
}

// Grafana Stack name (for Mimir Tenant Id)
argument "grafana_stack" {
	optional = false
}

// Cluster Service Provider namne (aws, gcp, azure)
argument "cloud_provider" {
	optional = false
}

export "receiver" {
	value = prometheus.remote_write.metrics.receiver
}

prometheus.remote_write "metrics" {
	external_labels = {
		cluster = argument.cluster_name.value,
		cloudProvider = argument.cloud_provider.value,
	}
	
	endpoint {
		url = argument.url.value

		basic_auth {
			username = argument.username.value
			password = argument.password.value
		}
		headers = {
			"X-Scope-OrgID" = argument.grafana_stack.value,
		}
	}
}
